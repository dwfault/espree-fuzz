// Owner: Christian Holler
// flag: --expose_gc
// v8 version: 3.21.18, ia32

function boom() {
	var args = [];
	for (var i = 0; i < 125000; i++)
		args.push(i);
	return Array.apply(Array, args);
}

/*
 * Sematically equivalent.
 * function boom() {
 *    var args = [];
 *    for (var i=0; i<125000; i++)
 *      args.push(i);
 *    var args2 = [];
 *    for (var i=0; i<125000; i++)
 *      args2.push(i);
 *    return args2;
 * }
 * */

var array = boom();
function fib(n) {
	var f0 = 0, f1 = 1;
	for (; n > 0; n = n -1) {
		f0 + f1;
		f0 = array;
	}
}
fib(75); // --> fib(10) also generates crash.

/*
    GC corruption.
    
    in src/store-buffer.cc, line 227 
    void storeBuffer::ExemptPopularPages(step, threshold)
        ....

	int old_counter = containing_chunk->store_buffer_counter();
	if (old_counter == threshold) { // --> old_counter >= threshold
            containing_chunk->set_scan_on_scavenge(true);
	    created_new_scan_on_scavenge_pages = true;
	}

        ....

    ref: jayconrod.com/posts/55/a-tour-of-v8-garbage-collection
*/
